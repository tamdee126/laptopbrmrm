<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô Labtop ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÅ‡∏°‡πà‡∏£‡∏∞‡∏°‡∏≤‡∏î</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏µ (‡∏ï‡∏≤‡∏°‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤) */
        body {
            font-family: 'Prompt', sans-serif;
            background-color: #e9ecef; /* Light gray-blue background */
        }
        .container-card {
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15); 
        }
        .hospital-primary {
            background-color: #007bff; /* Blue */
        }
        .hospital-text {
            color: #007bff;
        }
        .loader {
            border-top-color: #007bff;
            -webkit-animation: spinner 1.5s linear infinite;
            animation: spinner 1.5s linear infinite;
        }
        @-webkit-keyframes spinner {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex items-center justify-center">

    <div class="container-card w-full max-w-5xl bg-white rounded-xl p-6 md:p-10">
        <header class="text-center mb-8">
            <h1 class="text-3xl lg:text-4xl font-extrabold hospital-text mb-2">
                ü©∫ ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå IT
            </h1>
            <p class="text-xl font-semibold text-gray-600 border-b pb-4">
                ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÅ‡∏°‡πà‡∏£‡∏∞‡∏°‡∏≤‡∏î (Labtop & Equipment Management)
            </p>
        </header>
        
        <form id="loanForm" class="space-y-6">
            <h2 class="text-2xl font-bold text-gray-800 border-l-4 border-blue-500 pl-3 mb-6">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ (‡∏¢‡∏∑‡∏°/‡∏Ñ‡∏∑‡∏ô)</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                <div class="space-y-6">
                    <div>
                        <label for="action" class="block text-base font-medium text-gray-700 mb-1">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ <span class="text-red-500">*</span></label>
                        <!-- NAME: action (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö doPost) -->
                        <select id="action" name="action" required 
                            class="mt-1 block w-full px-4 py-3 border border-gray-300 bg-white rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-lg transition duration-150 ease-in-out appearance-none">
                            <option value="‡∏¢‡∏∑‡∏°" selected>‚ñ∂Ô∏è ‡∏¢‡∏∑‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</option>
                            <option value="‡∏Ñ‡∏∑‡∏ô">‚Ü©Ô∏è ‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</option>
                        </select>
                    </div>

                    <div>
                        <label for="equipment" class="block text-base font-medium text-gray-700 mb-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <span class="text-red-500">*</span></label>
                        <!-- NAME: equipment (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö doPost) -->
                        <select id="equipment" name="equipment" required 
                            class="mt-1 block w-full px-4 py-3 border border-gray-300 bg-white rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-lg transition duration-150 ease-in-out appearance-none">
                            <option value="" disabled selected>--- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ ---</option>
                            </select>
                    </div>

                    <div>
                        <label for="borrowerName" class="block text-base font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô (‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°/‡∏ú‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô) <span class="text-red-500">*</span></label>
                        <!-- NAME: borrowerName (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö doPost) -->
                        <input type="text" id="borrowerName" name="borrowerName" required placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡∏™‡∏°‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡πÉ‡∏à‡∏î‡∏µ ‡∏´‡∏£‡∏∑‡∏≠ IT-1"
                            class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-lg transition duration-150 ease-in-out">
                    </div>
                </div>

                <div class="space-y-6">
                    <div id="departmentGroup">
                        <label for="department" class="block text-base font-medium text-gray-700 mb-1">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô / ‡πÅ‡∏ú‡∏ô‡∏Å <span class="text-red-500">*</span></label>
                        <!-- NAME: department (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö doPost) -->
                        <input type="text" id="department" name="department" placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡∏ù‡πà‡∏≤‡∏¢ IT, ‡πÅ‡∏ú‡∏ô‡∏Å‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ô‡∏≠‡∏Å" required
                            class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-lg transition duration-150 ease-in-out">
                    </div>

                    <div id="phoneNumberGroup">
                        <label for="phoneNumber" class="block text-base font-medium text-gray-700 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ <span class="text-red-500">*</span></label>
                        <!-- NAME: phoneNumber (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö doPost) -->
                        <input 
                            type="text" 
                            id="phoneNumber" 
                            name="phoneNumber" 
                            placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 0912345678 (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ 10 ‡∏´‡∏•‡∏±‡∏Å)" 
                            pattern="[0-9]{10}"
                            title="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ 10 ‡∏´‡∏•‡∏±‡∏Å ‡πÄ‡∏ä‡πà‡∏ô 0912345678"
                            maxlength="10"
                            required
                            class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-lg transition duration-150 ease-in-out">
                    </div>
                    
                    <div id="dueDateGroup">
                        <label for="dueDate" class="block text-base font-medium text-gray-700 mb-1">üìÖ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô <span class="text-red-500">*</span></label>
                        <!-- NAME: dueDate (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö doPost) -->
                        <input type="date" id="dueDate" name="dueDate" required
                            class="mt-1 block w-full px-4 py-3 border border-gray-300 bg-white rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-lg transition duration-150 ease-in-out">
                    </div>

                </div>
            </div> 
            
            <div id="reasonGroup">
                <label for="reason" class="block text-base font-medium text-gray-700 mb-1">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏° <span class="text-red-500">*</span></label>
                <!-- NAME: reason (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö doPost) -->
                <textarea id="reason" name="reason" rows="3" placeholder="‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‡πÄ‡∏ä‡πà‡∏ô: ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ô‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà, ‡∏≠‡∏ö‡∏£‡∏°, ‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß" required
                    class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out text-lg"></textarea>
            </div>

            <button type="submit" id="submitBtn"
                class="w-full flex justify-center items-center py-3 px-4 border border-transparent rounded-lg shadow-lg text-lg font-bold text-white hospital-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300 ease-in-out transform hover:scale-[1.01] mt-8">
                <svg id="submitIcon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span id="submitText">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
            </button>
        </form>

        <div id="statusMessage" class="mt-6 p-4 rounded-lg text-lg font-semibold hidden transition duration-300"></div>

        <div id="loader" class="mt-6 flex justify-center items-center hidden">
            <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-8 w-8"></div>
            <span class="ml-3 text-lg text-gray-600" id="loaderText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå...</span>
        </div>

        <div class="mt-10 pt-6 border-t border-gray-200">
            <h2 class="text-2xl font-bold text-gray-800 border-l-4 border-green-600 pl-3 mb-4">üñ•Ô∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (Real-time)</h2>
            <p class="text-sm text-gray-500 mb-4">
                *‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏ö‡∏ö Real-time ‡∏à‡∏≤‡∏Å Log ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
            </p>
            <div id="equipmentList" class="space-y-4">
                <p class="text-center text-gray-500 p-4 bg-gray-50 rounded-lg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå...</p>
            </div>
        </div>
    </div>
    
    <script>
    // *****************************************************************************************************************
    // *** ‚ö†Ô∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å: ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô Web App URL ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ Deploy Google Apps Script ***
    // *****************************************************************************************************************
    // ‡πÉ‡∏ä‡πâ URL ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤‡πÉ‡∏ô‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzwClVjQBa_vnVgurZdS7BWnXBWPb_yGquA0bwJ0TpeN6DXZZqNmR8nBQvOk8iuMcgZ/exec"; 
    // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ñ‡∏á‡∏ó‡∏µ‡πà (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
    const equipmentInventory = [
        { name: "HP Pavilion Gaming", details: "Ôºà‡∏£‡∏±‡∏ö 1/9/2020 RMC 16994 No.7440-013-0002/0033Ôºâ" },
        { name: "Asus X512DA-EJ1021T (15.6) ‡∏™‡∏µ‡∏™‡πâ‡∏°", details: "Ôºà‡∏£‡∏±‡∏ö 15/5/2020 RMC 16760 NO.7440-013-0002/0030Ôºâ" },
        { name: "Asus N/b asus D413A ‡∏™‡∏µ‡∏î‡∏≥", details: "Ôºà‡∏£‡∏±‡∏ö 15/5/2020 RMC 14993 NO.7440-013-0002/0026Ôºâ" },
        { name: "MSI modern 14 b5m ‡∏™‡∏µ‡∏î‡∏≥ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏•‡πá‡∏Å", details: "Ôºà‡∏£‡∏±‡∏ö 25/08/2021 RMC 17609 NO.7440-013-0002/0040Ôºâ" },
        { name: "MSI GF63 Thin 10SCXR-1634TH ‡∏™‡∏µ‡∏î‡∏≥ (15.6) ", details: "Ôºà‡∏£‡∏±‡∏ö 01/10/2021 RMC 17649 NO.7440-013-0002/0041Ôºâ" },
        { name: "Lenovo ThinkPad AMD RYZEN 5 4000 SERIES ‡∏™‡∏µ‡∏î‡∏≥", details: "Ôºà‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πåÔºâ" },
    ];

    let currentEquipmentStatus = {}; // ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå

    // Element Selectors
    const form = document.getElementById('loanForm');
    const equipmentSelect = document.getElementById('equipment');
    const equipmentListDiv = document.getElementById('equipmentList');
    const actionSelect = document.getElementById('action');
    const dueDateGroup = document.getElementById('dueDateGroup');
    const reasonGroup = document.getElementById('reasonGroup');
    const departmentInput = document.getElementById('department');
    const phoneNumberInput = document.getElementById('phoneNumber');
    const reasonTextarea = document.getElementById('reason');
    const statusMessage = document.getElementById('statusMessage');
    const loader = document.getElementById('loader');
    const loaderText = document.getElementById('loaderText');
    const submitBtn = document.getElementById('submitBtn');
    const submitText = document.getElementById('submitText');
    const submitIcon = document.getElementById('submitIcon');


    // Helper function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á Loader ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏∏‡πà‡∏°
    function toggleLoader(show, text = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...') {
        loaderText.textContent = text;
        if (show) {
            loader.classList.remove('hidden');
            submitBtn.disabled = true;
            submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
            submitText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...';
            submitIcon.classList.add('hidden'); // ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô Submit
        } else {
            loader.classList.add('hidden');
            submitBtn.disabled = false;
            submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏≤‡∏° Action ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            submitText.textContent = `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£${actionSelect.value === '‡∏¢‡∏∑‡∏°' ? ' (‡∏¢‡∏∑‡∏°)' : ' (‡∏Ñ‡∏∑‡∏ô)'}`;
            submitIcon.classList.remove('hidden'); 
        }
    }

    // Helper function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
    function showMessage(message, isSuccess = true) {
        statusMessage.textContent = message;
        statusMessage.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700', 'bg-yellow-100', 'text-yellow-700');
        statusMessage.classList.add(isSuccess ? 'bg-green-100' : 'bg-red-100', isSuccess ? 'text-green-700' : 'text-red-700');
        setTimeout(() => {
            statusMessage.classList.add('hidden');
        }, 5000);
    }

    // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Dropdown List ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏•‡∏∞ Action ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    function updateEquipmentSelectOptions() {
        const selectedAction = actionSelect.value;
        const isBorrowAction = selectedAction === '‡∏¢‡∏∑‡∏°';
        
        equipmentSelect.innerHTML = '<option value="" disabled selected>--- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ ---</option>';
        submitText.textContent = `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£${isBorrowAction ? ' (‡∏¢‡∏∑‡∏°)' : ' (‡∏Ñ‡∏∑‡∏ô)'}`;


        let optionsAdded = 0;

        equipmentInventory.forEach(item => {
            const equipmentName = item.name;
            const statusInfo = currentEquipmentStatus[equipmentName];
            // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏≠: ‡πÑ‡∏°‡πà‡∏°‡∏µ log ‡∏´‡∏£‡∏∑‡∏≠ log ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠ '‡∏Ñ‡∏∑‡∏ô'
            const isAvailable = !statusInfo || statusInfo.action === '‡∏Ñ‡∏∑‡∏ô';

            let shouldAdd = false;
            let displayStatus = item.details;

            if (isBorrowAction) {
                // ‡∏¢‡∏∑‡∏°: ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                if (isAvailable) {
                    shouldAdd = true;
                    displayStatus = `‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏° | ${item.details}`;
                }
            } else {
                // ‡∏Ñ‡∏∑‡∏ô: ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà
                if (!isAvailable) {
                    shouldAdd = true;
                    const borrower = statusInfo.borrowerName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                    const dueDate = statusInfo.dueDate ? new Date(statusInfo.dueDate).toLocaleDateString('th-TH') : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                    displayStatus = `‚ö†Ô∏è ‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°‡πÇ‡∏î‡∏¢: ${borrower} (‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô: ${dueDate})`;
                }
            }

            if (shouldAdd) {
                const option = document.createElement('option');
                option.value = equipmentName;
                option.textContent = `${equipmentName} - ${displayStatus}`;
                equipmentSelect.appendChild(option);
                optionsAdded++;
            }
        });

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≤‡∏° Action
        if (optionsAdded === 0) {
            const msg = document.createElement('option');
            msg.value = "N/A";
            msg.disabled = true;
            msg.textContent = isBorrowAction ? '‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ' : '‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà (Log ‡∏™‡∏∞‡∏≠‡∏≤‡∏î)';
            equipmentSelect.appendChild(msg);
            submitBtn.disabled = true; // ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏° Submit ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ó‡∏≥
            submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
        } else {
            submitBtn.disabled = false;
            submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }
    }


    // 2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏à‡∏≤‡∏Å Log
    function calculateCurrentStatus(logs) {
        const statusMap = {}; 
        // ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• Log ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (Log ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏à‡∏∞‡∏ä‡∏ô‡∏∞)
        logs.forEach(log => {
            statusMap[log.equipment] = {
                action: log.action,
                borrowerName: log.borrowerName,
                department: log.department, // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
                phoneNumber: log.phoneNumber, // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
                reason: log.reason, // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
                dueDate: log.dueDate
            };
        });

        currentEquipmentStatus = statusMap;
    }

    // 3. ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Real-time
    function renderEquipmentList() {
        equipmentListDiv.innerHTML = ''; 
        let allAvailable = true;

        equipmentInventory.forEach(item => {
            const statusInfo = currentEquipmentStatus[item.name];
            let statusText = '';
            let statusClass = '';
            let detailText = item.details;

            let extraInfo = '';

            if (statusInfo && statusInfo.action === '‡∏¢‡∏∑‡∏°') {
                // ‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°
                allAvailable = false;
                const borrower = statusInfo.borrowerName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠';
                const dept = statusInfo.department || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÅ‡∏ú‡∏ô‡∏Å';
                const phone = statusInfo.phoneNumber || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£';
                const reason = statusInfo.reason || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•';
                const dueDate = statusInfo.dueDate ? new Date(statusInfo.dueDate).toLocaleDateString('th-TH') : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                statusText = `‚õî ‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏° (‡∏Ñ‡∏∑‡∏ô ${dueDate})`;
                statusClass = 'bg-red-50 text-red-700 border-red-300 shadow-lg';
                extraInfo = `
                    <div class="mt-2 text-xs md:text-sm text-red-600 bg-red-100 p-2 rounded-lg space-y-1">
                        <p><strong class="font-bold">‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°:</strong> ${borrower} (${dept})</p>
                        <p><strong class="font-bold">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</strong> ${phone}</p>
                        <p><strong class="font-bold">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:</strong> ${reason}</p>
                    </div>
                `;
            } else {
                // ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                statusText = '‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
                statusClass = 'bg-green-50 text-green-700 border-green-300';
            }
            
            // Format details to be less prominent
            const formattedDetails = `<span class="text-xs text-gray-500 mt-1 md:mt-0 md:ml-4 flex-grow truncate">${detailText}</span>`;


            const itemDiv = document.createElement('div');
            itemDiv.className = `p-4 rounded-xl border flex flex-col transition duration-150 ease-in-out hover:shadow-xl ${statusClass}`;
            itemDiv.innerHTML = `
                <div class="flex flex-col md:flex-row md:justify-between md:items-center">
                    <span class="font-bold text-gray-800">${item.name}</span>
                    ${formattedDetails}
                    <span class="text-sm font-semibold mt-2 md:mt-0 md:ml-auto whitespace-nowrap">${statusText}</span>
                </div>
                ${extraInfo}
            `;
            equipmentListDiv.appendChild(itemDiv);
        });

        if (allAvailable && equipmentInventory.length > 0) {
             const allAvailableMsg = document.createElement('div');
             allAvailableMsg.className = 'p-4 text-center bg-blue-100 text-blue-700 rounded-lg font-semibold';
             allAvailableMsg.textContent = 'ü•≥ ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°!';
             equipmentListDiv.insertBefore(allAvailableMsg, equipmentListDiv.firstChild);
        } else if (equipmentInventory.length === 0) {
             equipmentListDiv.innerHTML = `<p class="text-center text-gray-500 p-4 bg-gray-50 rounded-lg">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á</p>`;
        }
    }

    // 4. ‡∏î‡∏∂‡∏á Log ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Apps Script (GET request)
    async function fetchRealtimeStatus() {
        toggleLoader(true, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå...');
        equipmentListDiv.innerHTML = '<p class="text-center text-gray-500 p-4 bg-gray-50 rounded-lg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå...</p>';

        try {
            // ‡πÉ‡∏ä‡πâ exponential backoff ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API
            const maxRetries = 3;
            let response;

            for (let i = 0; i < maxRetries; i++) {
                try {
                    response = await fetch(APPS_SCRIPT_URL, {
                        method: 'GET',
                        redirect: 'follow', 
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' } 
                    });

                    if (response.ok) break; // ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                    
                    if (i < maxRetries - 1) {
                        const delay = Math.pow(2, i) * 1000; // 1s, 2s, 4s
                        await new Promise(resolve => setTimeout(resolve, delay));
                    } else {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                } catch (error) {
                    if (i === maxRetries - 1) throw error; // ‡πÇ‡∏¢‡∏ô error ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏ñ‡πâ‡∏≤‡∏•‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß
                }
            }
            
            if (!response || !response.ok) {
                throw new Error("Failed to fetch status after multiple retries.");
            }

            const result = await response.json();
            
            if (result.status === 'success') {
                calculateCurrentStatus(result.logs);
                renderEquipmentList();
                updateEquipmentSelectOptions(); 
            } else {
                showMessage(`‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${result.message || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'}`, false);
                equipmentListDiv.innerHTML = `<p class="text-center text-red-500 p-4 bg-red-100 rounded-lg">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${result.message || '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Console'}</p>`;
            }
        } catch (error) {
            console.error("Fetch GET Error:", error);
            showMessage(`‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Web App URL ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Console ‡πÅ‡∏•‡∏∞ URL`, false);
            equipmentListDiv.innerHTML = `<p class="text-center text-red-500 p-4 bg-red-100 rounded-lg">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Web App URL ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Console ‡πÅ‡∏•‡∏∞ URL</p>`;
        } finally {
            toggleLoader(false);
        }
    }

    // 5. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á Action (‡∏¢‡∏∑‡∏°/‡∏Ñ‡∏∑‡∏ô)
    actionSelect.addEventListener('change', (e) => {
        const isBorrow = e.target.value === '‡∏¢‡∏∑‡∏°';

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡∏ä‡πà‡∏≠‡∏á Due Date ‡πÅ‡∏•‡∏∞ Reason
        if (isBorrow) {
            dueDateGroup.classList.remove('hidden');
            reasonGroup.classList.remove('hidden'); 
            document.getElementById('dueDate').setAttribute('required', 'required');
            document.getElementById('reason').setAttribute('required', 'required');
        } else {
            dueDateGroup.classList.add('hidden');
            reasonGroup.classList.add('hidden'); 
            document.getElementById('dueDate').removeAttribute('required');
            document.getElementById('reason').removeAttribute('required');
        }
        
        // ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå ‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Required ‡πÄ‡∏™‡∏°‡∏≠
        departmentInput.setAttribute('required', 'required');
        phoneNumberInput.setAttribute('required', 'required');

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏ô Dropdown ‡∏ï‡∏≤‡∏° Action ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        updateEquipmentSelectOptions();
    });

    // 6. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£ Submit Form (POST request)
    form.addEventListener('submit', async (e) => {
        // ‡πÉ‡∏´‡πâ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö HTML5 Validation (‡πÄ‡∏ä‡πà‡∏ô pattern="[0-9]{10}") ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡πà‡∏≠‡∏ô
        if (!form.checkValidity()) {
            // ‡∏´‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏≠‡∏á
            return;
        }

        e.preventDefault();

        // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        const action = actionSelect.value;
        const equipment = equipmentSelect.value;
        const borrowerName = document.getElementById('borrowerName').value;
        const department = departmentInput.value; 
        const phoneNumber = phoneNumberInput.value.trim(); // ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å input type="text"
        
        // üö® ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö 10 ‡∏´‡∏•‡∏±‡∏Å‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏î‡∏¢ pattern="[0-9]{10}" ‡πÉ‡∏ô HTML ‡πÅ‡∏•‡πâ‡∏ß


        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        const reason = (action === '‡∏¢‡∏∑‡∏°') ? reasonTextarea.value : '‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå'; 
        const dueDate = (action === '‡∏¢‡∏∑‡∏°') ? document.getElementById('dueDate').value : '';


        // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà HTML5 Validation ‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°)
        if (equipmentSelect.value === "" || equipmentSelect.value === "N/A" || equipmentSelect.value.startsWith('---')) {
             showMessage("‚ùó ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ", false);
             return;
        }
        if (borrowerName.trim() === "" || department.trim() === "") {
             showMessage("‚ùó ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏ ‡∏ä‡∏∑‡πà‡∏≠ ‡πÅ‡∏•‡∏∞ ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô/‡πÅ‡∏ú‡∏ô‡∏Å ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô", false);
             return;
        }
        if (action === '‡∏¢‡∏∑‡∏°' && (dueDate.trim() === "" || reasonTextarea.value.trim() === "")) { // ‡πÉ‡∏ä‡πâ reasonTextarea.value ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏Å
             showMessage("‚ùó ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô ‡πÅ‡∏•‡∏∞ ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏° ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô", false);
             return;
        }
        
        // 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏ã‡πâ‡∏≥/‡∏Ñ‡∏∑‡∏ô‡∏ú‡∏¥‡∏î (Double check against current status)
        const currentStatus = currentEquipmentStatus[equipment];
        const isCurrentlyBorrowed = currentStatus && currentStatus.action === '‡∏¢‡∏∑‡∏°';

        if (action === '‡∏¢‡∏∑‡∏°' && isCurrentlyBorrowed) {
            showMessage(`‚ùå ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ${equipment} ‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏î‡∏¢ ${currentStatus.borrowerName} ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏∑‡∏°‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ!`, false);
            return;
        }

        if (action === '‡∏Ñ‡∏∑‡∏ô' && !isCurrentlyBorrowed) {
            showMessage(`‚ùå ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ${equipment} ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏° ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ!`, false);
            return;
        }


        // 4. ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ POST
        toggleLoader(true, `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£${action}...`);
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á URLSearchParams ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏°‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö POST
        const params = new URLSearchParams();
        params.append('action', action);
        params.append('equipment', equipment);
        params.append('borrowerName', borrowerName);
        params.append('department', department); 
        params.append('phoneNumber', phoneNumber); // ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å input (‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô String)
        params.append('reason', reason); // Reason ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏°‡∏≠ (‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∑‡∏ô‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô '‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå')
        params.append('dueDate', dueDate); // dueDate ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠ '‡∏¢‡∏∑‡∏°' ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏û‡∏£‡πâ‡∏≠‡∏° Exponential Backoff
        const postDataWithRetry = async () => {
            const maxRetries = 3;
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(APPS_SCRIPT_URL, {
                        method: 'POST',
                        body: params, 
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        }
                    });
                    
                    if (response.ok) return response; // ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                    
                    if (i < maxRetries - 1) {
                        const delay = Math.pow(2, i) * 1000; // 1s, 2s, 4s
                        await new Promise(resolve => setTimeout(resolve, delay));
                    } else {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                } catch (error) {
                    if (i === maxRetries - 1) throw error; // ‡πÇ‡∏¢‡∏ô error ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏ñ‡πâ‡∏≤‡∏•‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß
                }
            }
            throw new Error("Failed to submit data after multiple retries.");
        };


        try {
            const response = await postDataWithRetry();
            const result = await response.json();
            
            if (result.status === 'success') {
                showMessage(`‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£${action}‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå: ${equipment} ‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏•‡πâ‡∏ß`, true);
                
                // Clear form fields
                document.getElementById('borrowerName').value = '';
                departmentInput.value = '';
                phoneNumberInput.value = '';
                reasonTextarea.value = '';
                document.getElementById('dueDate').value = '';

                // Reset Action select and trigger change to reset dropdown/visibility
                actionSelect.value = '‡∏¢‡∏∑‡∏°';
                actionSelect.dispatchEvent(new Event('change')); 
                
                // ‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                await fetchRealtimeStatus(); 

            } else {
                showMessage(`‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: ${result.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Google Sheet ‡πÑ‡∏î‡πâ'}`, false);
            }

        } catch (error) {
            console.error("Fetch Error:", error);
            showMessage(`‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠: ${error.message}`, false);
        } finally {
            toggleLoader(false);
        }
    });

    // Initial setup
    window.onload = () => {
        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤ ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        fetchRealtimeStatus(); 
        actionSelect.dispatchEvent(new Event('change')); // Set initial state for Due Date & Dropdown
    };
</script>
</body>
</html>

